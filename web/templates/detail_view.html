<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>Detail Security Analysis - {{ commit_sha[:7] }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🛡️</text></svg>">
    <style>
        :root{
            --bg: #f9fafb; --panel: #ffffff; --border: #e5e7eb; --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --text-main: #111827; --text-muted: #6b7280;
            --status-good-bg: #dcfce7; --status-good-text: #166534;
            --status-warn-bg: #fef9c3; --status-warn-text: #854d0e;
            --status-bad-bg: #fee2e2; --status-bad-text: #991b1b;
            --status-unknown-bg: #f3f4f6; --status-unknown-text: #4b5563;
            --code-bg: #0f172a; --code-text: #e2e8f0; --code-muted: #94a3b8;
            --progress-bar: #4f46e5;
        }
        body { margin: 0; background-color: var(--bg); color: var(--text-main); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .wrap { max-width: 1200px; margin: 24px auto; padding: 0 24px; }
        header { background-color: var(--panel); padding: 16px 24px; border-radius: 12px; box-shadow: var(--shadow); margin-bottom: 24px; }
        header h1 { font-size: 20px; margin: 0 0 4px 0; }
        header p { margin: 0; color: var(--text-muted); font-family: monospace; }
        .summary-grid { display: grid; gap: 24px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); margin-bottom: 24px; }
        .card { background-color: var(--panel); border-radius: 12px; box-shadow: var(--shadow); overflow: hidden; }
        .card-header { padding: 12px 16px; border-bottom: 1px solid var(--border); }
        .card-header h2 { font-size: 16px; margin: 0; }
        .card-body { padding: 16px; font-size: 14px; line-height: 1.6; }
        .status-good { background-color: var(--status-good-bg); color: var(--status-good-text); }
        .status-warn { background-color: var(--status-warn-bg); color: var(--status-warn-text); }
        .status-bad { background-color: var(--status-bad-bg); color: var(--status-bad-text); }
        .info-list { margin: 0; padding-left: 18px; }
        .card-divider { border: 0; border-top: 1px solid var(--border); margin: 16px 0; }
    </style>
</head>
<body>
    <div class="wrap">
        <header>
            <h1>보안 및 코드 상세 분석</h1>
            <p>Commit: {{ repo_name }}@{{ commit_sha }}</p>
        </header>

        <section class="summary-grid">
            <div id="identityCard" class="card status-unknown">
                <div class="card-header"><h2>계정 신원 검증</h2></div>
                <div class="card-body" id="identityBody"><p>로딩 중...</p></div>
            </div>
            <div id="defenderCard" class="card status-unknown">
                <div class="card-header"><h2>CodeQL 분석</h2></div>
                <div class="card-body" id="defenderBody"><p>로딩 중...</p></div>
            </div>
            <div id="bricksCard" class="card status-unknown">
                <div class="card-header"><h2>BRICKS 이상 감지</h2></div>
                <div class="card-body" id="bricksBody"><p>로딩 중...</p></div>
            </div>
        </section>

        <section id="commitReviewCard" class="card">
            <div class="card-header"><h2>커밋 상세 & 코드 리뷰</h2></div>
            <div class="card-body review-body">
                <div id="commitMeta" class="review-meta"></div>
                <div id="commitFiles" class="review-files"></div>
                <div class="review-panel">
                    <h3>대화형 코드 리뷰</h3>
                    <div id="commentsList" class="comments-list"><div class="empty-state">댓글을 불러오는 중...</div></div>
                    <form id="commentForm" class="review-form"></form>
                </div>
            </div>
        </section>
    </div>

<script>
(()=> {
  const repo = {{ repo_name|tojson }};
  const sha = {{ commit_sha|tojson }};
  const branch = {{ branch_name|tojson }};
  const identityBody = document.getElementById('identityBody');
  const defenderBody = document.getElementById('defenderBody');
  const bricksBody = document.getElementById('bricksBody');
  const commitMetaEl = document.getElementById('commitMeta');
  const commitFilesEl = document.getElementById('commitFiles');
  const commentsListEl = document.getElementById('commentsList');
  const commentFormEl = document.getElementById('commentForm');
  let cachedComments = [];

  function esc(s) { return (s === null || s === undefined) ? '' : String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c] || c); }
  // 이하 원본 코드 전체 포함
})();
</script>
</body>
</html>
